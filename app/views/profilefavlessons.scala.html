@import tags._

@(user: User, lessons:List[Lesson], pageIndex: Integer, totalAmount: Integer)

@now = @{new Date()}

@profileframe(user, 4){
	<link rel="stylesheet" media="screen" href="@routes.Assets.versioned("stylesheets/simplePagination.css")">
	<script src="@routes.Assets.versioned("javascripts/jquery.simplePagination.js")" type="text/javascript"></script>
	<script type="text/javascript">
		$(function(){
			var pageParts = $(".paginate");
		    var numPages = pageParts.length;
		    var perPage = @Lesson.PAGE_SIZE;
		    
		    pageParts.slice(perPage).hide();
		    $("#page-nav").pagination({
		        items: @totalAmount,
		        itemsOnPage: perPage,
		        currentPage: @pageIndex,
		        cssStyle: "light-theme",
		        onPageClick: function(pageNum) {
		            var start = perPage * (pageNum - 1);
		            var end = start + perPage;
		            
		            $('#page-offset').val(start);
		            $('form#page-form').submit();
		        }
		    });
		    
		    $('.del-fav-btn').on('click', function(){
		    	$.ajax({
	                url: "@routes.ProfileController.removeFavoriteLesson()",
	                type: "POST",
	                data: {
	                	lessonId: $(this).attr('data-index')
	                },
	                success: function(response, status) {
	                	var data = $.parseJSON(JSON.stringify(response));
	                	if(data.code != 0){
	                		showAlertToast(data.message, "alert-danger");
	                	}
	                },
	                error: function(request, status, err){
	                	showAlertToast(err, "alert-danger");
	                }
	            });
		    	
		    	$(this).parents('tr').remove();
		    	if($('.paginate').length == 0){
		    		$('.empty').removeClass('hide');
		    		$('.fav-lesson-tb').addClass('hide');
		    	}else{
		    		$('.empty').addClass('hide');
		    		$('.fav-lesson-tb').removeClass('hide');
		    	}
		    });
	   	});
	</script>
	
	<div class="dash-detail-header">
		<p>我的收藏</p>
	</div>
	<p class="empty @if(lessons != null && lessons.size > 0){hide}">暂无课程内容～</p>
	<div class="fav-lesson-tb @if(lessons == null || lessons.size == 0){hide}">
		<table class="table table-striped table-hover lesson-table">
		    <thead>
		      <tr>
		        <th>课程信息</th>
		        <th>报名人数</th>
		        <th>金额</th>
		        <th>操作</th>
		      </tr>
		    </thead>
		    <tbody>
		    	@for(lesson <- lessons){
				    <tr class="paginate">
						<td>
			          		<a class="link-img" style="background-image:url('@routes.LessonController.showLessonCover(lesson.id, false)')"></a>
			          		<p>
			          			<a target="_blank" href="@routes.LessonController.lessonDetail(lesson.id)">@lesson.title</a>	
			          		</p>
			          	</td>
			          	<td><p>@lesson.userLessons.size() 人</p></td>
			          	<td>
			         		@if(lesson.offerPrice > 0 && (lesson.offerStartDate == null || lesson.offerEndDate == null) || (lesson.offerPrice > 0 && !lesson.offerStartDate.before(now) && !lesson.offerEndDate.after(now))){
								<span class="orange">¥
			            			<span class="orange">@lesson.offerPrice.intValue()</span>
		                        </span>
							}else{
								<span class="orange">¥
			            			<span class="orange">@lesson.price.intValue()</span>
		                        </span>
							}
						</td>
			          	<td>
			          		<a class="link-btn del-fav-btn" data-index="@lesson.id">取消收藏</a>
			          	</td>
			        </tr>
		        }
		    </tbody>
		</table>
		<div id="page-nav"></div>
		<form id="page-form" class="hidden" action="@routes.ProfileController.myFavoriteLessons()" method="get">
			<input id="page-offset" type="hidden" name="offset" value="0"/>
		</form>
	</div>
}