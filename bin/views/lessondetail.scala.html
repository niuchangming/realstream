@import tags._
@import tools.Utils

@(account: Account, lesson: Lesson)

@now = @{new Date()}

@diff(d1: Date, d2: Date) = @{
  	Utils.differentDateTimeByMins(d1, d2)
}

@scripts = {
	<link rel="stylesheet" href="@routes.Assets.versioned("stylesheets/froala/font-awesome.min.css")">
    <script type="text/javascript">
		$(function(){
			$('.tabs-tt').on('click', function(){
				$('.tabs-tt.active').removeClass('active');
				$(this).addClass('active');
				
				$('.tabs-content').addClass('hide');
				if($(this).text() === 'SUMMARY'){
					$('#basic_tab').removeClass('hide');
				}else if($(this).text() === 'CATALOG'){
					$('#dir_tab').removeClass('hide');
				}else if($(this).text() === 'COMMENTS'){
					$('#comment_tab').removeClass('hide');
				}
			});
			
			$('.f-radio').on('click', function(){
				$('.f-radio.checked').removeClass('checked');
				$(this).addClass('checked');
				
				$('.comment-item.hide').removeClass('hide');
				
				var id = $(this).attr('data-id');
				if(id === "1"){
					$('.comment-item.point1').addClass('hide');
					$('.comment-item.point2').addClass('hide');
					$('.comment-item.point3').addClass('hide');
				}else if(id === "2"){
					$('.comment-item.point1').addClass('hide');
					$('.comment-item.point2').addClass('hide');
					$('.comment-item.point4').addClass('hide');
					$('.comment-item.point5').addClass('hide');
				}else if(id === "3"){
					$('.comment-item.point3').addClass('hide');
					$('.comment-item.point4').addClass('hide');
					$('.comment-item.point5').addClass('hide');
				}
			});
			
			$('.btn-favorite').on('click', function(){
				@if(account == null){
					$('#entry-model').modal('show');
				}else{
					var favIco = $('.btn-favorite > i');
					favIco.removeClass('fa-heart');
					favIco.addClass('fa-spinner');
					$.ajax({
		                url: "@routes.ProfileController.addFavoriteLesson()",
		                type: "POST",
		                data: {
		                	lessonId: '@lesson.id'
		                },
		                success: function(response, status) {
		                	var data = $.parseJSON(JSON.stringify(response));
		                	if(data.code == 0){
		                		favIco.addClass('red');
		                		favIco.removeClass('fa-spinner');
		                		favIco.addClass('fa-heart');
		                		showAlertToast(data.message, "alert-success");
		                	}else if(data.code == 5000){
		                		favIco.removeClass('fa-spinner');
		                		favIco.addClass('fa-heart');
		                		showAlertToast(data.message, "alert-warning");
		                	}else{	
		                		favIco.removeClass('fa-spinner');
		                		favIco.addClass('fa-heart');
		                		showAlertToast(data.message, "alert-danger");
		                	}
		                },
		                error: function(request, status, err){
		                	console.log(err);
		                }
		            });
				}
			});
			
			$.ajax({
                url: "@routes.CommentController.commentsByLesson()",
                type: "POST",
                data: {
                	lessonId: @lesson.id
                },
                success: function(response, status) {
                	var data = $.parseJSON(JSON.stringify(response));
                	
                	if(data.code == 0 && data.data != ''){
                		$.each(data.data, function (index, value) {
                			var commentHtml = '<div class="comment-item point' + value.point + '">';
                				commentHtml += '<div class="item-left"> <img class="user-avatar" src="/profile/show/avatar/thumbnail?thumbnailUUID='+value.authorAvatar+'">';
                				commentHtml += '<p class="user-name">' + value.author + '</p>';
                				commentHtml += '</div>';
                				commentHtml += '<div class="item-right">';
                				commentHtml += '<div class="star-list">';
                				commentHtml += '<i class="fa fa-star ' + (value.point == 1 ? 'active' : '') + '"></i>';
                				commentHtml += '<i class="fa fa-star ' + (value.point == 2 ? 'active' : '') + '"></i>';
                				commentHtml += '<i class="fa fa-star ' + (value.point == 3 ? 'active' : '') + '"></i>';
                				commentHtml += '<i class="fa fa-star ' + (value.point == 4 ? 'active' : '') + '"></i>';
                				commentHtml += '<i class="fa fa-star ' + (value.point == 5 ? 'active' : '') + '"></i>';
                				commentHtml += '</div>';
                				commentHtml += '<div class="comment-bd">' + value.comment + '</div>';
                				commentHtml += '<div class="comment-ft"><span class="comment-where">Commented On:</span><span> </span><span class="comment-time">' + new Date(value.createDatetime).toISOString().substr(0, 10) + '</span></div>';
                				commentHtml += '</div></div>';
                				
                				$('.comment-list').append(commentHtml);
                		});
                	}else{
                		var emptyHtml = '<p class="empty">There is no any comment.～</p>';
                		$('.comment-list').append(emptyHtml);
                	}
                },
                error: function(request, status, err){
                	console.log(err);
                }
            });
		});
	</script>
}

@main(scripts) {
	@topbar(account)
	<nav class="bread-crumb inner-center">
	    <a class="bread-crumb-item" href="/course/list">首页</a>
	    <i class="fa fa-angle-right"></i>
	    <a class="bread-crumb-item" href="/course/list?mt=1005">全部课程</a>
	    <i class="fa fa-angle-right"></i>
	    <a class="bread-crumb-item" href="/course/list?mt=1005&amp;st=2031">考试</a>
	    <i class="fa fa-angle-right"></i>
	    <a class="bread-crumb-item" href="/course/list?mt=1005&amp;st=2031&amp;tt=3178">A水准培训</a>
	    <i class="fa fa-angle-right"></i>
	    <a class="bread-crumb-item item-current" href="/course/173429">课程详情</a>
	</nav>
	
	<div class="lesson-main">
	    <div class="lesson-basic-wrap">
	        <div class="lesson-basic">
	            <div class="img-left-wrap">
	                <img class="img-left" src="@routes.LessonController.showLessonCover(lesson.id, true)" alt="管理类联考数学救命夺分营">
	                <a class="play-btn" href="">
		      			<i class="fa fa-play"></i>播放
		      		</a>
	                <ul class="pay-policy">
	                    <li class="pay-policy-title">服务承诺 :</li>
	                    <li><a href="#" target="_blank"><i class="icon-policy"></i>支付保障</a></li>
	                    <li><a href="#" target="_blank"><i class="icon-refund"></i>课前随时退</a></li>
	                    <li><a class="js-videoreplay" href="#" target="_blank"><i class="icon-replay"></i>课后有回放</a></li>
	                </ul>
	                <div style="clear:both;"></div>
	            </div>
	            <div class="info-wrap">
	                <h3 class="page-tt">@lesson.title</h3>
	                <div class="tt-below-line">
	                    <span class="line-item statistics-apply">
	                    	报名人数
                    		<span class="apply-num js-apply-num">@lesson.userLessons.size()</span>
	                    </span>
	                    <i class="icon-sep"></i>
	                    <span class="line-item statistics-rate">
		         			好评度 
		         			<span class="rate-num"> 100% </span>
	                    </span>
	                    <i class="icon-sep"></i>
	                    <div class="line-item item-share">
	                        <i class="fa fa-share-alt"></i>分享
	                        <div class="tips-share">
	                            <ul class="share-list">
	                                <li class="share-qq icon-qq" data-to="qq"></li>
	                                <li class="share-qzone icon-qzone" data-to="qzone"></li>
	                                <li class="share-weixin icon-weixin" data-to="weixin"></li>
	                            </ul>
	                        </div>
	                    </div>
	                    <span class="line-item btn-favorite">
							<i class="fa fa-heart"></i>收藏
						</span>
	                </div>
	                <div class="lesson-period">
	                    <p>
	                    	@lesson.startDatetime.format("dd-MMM-yyyy") 
	                    	<span> </span>TO<span> </span> 
	                    	@lesson.endDatetime.format("dd-MMM-yyyy")
                    	</p>
	                </div>
	                <div class="lesson-price">
	                    <p class="lesson-price-info">
	                    	@if(lesson.offerPrice > 0 && (lesson.offerStartDate == null || lesson.offerEndDate == null) || (lesson.offerPrice > 0 && !lesson.offerStartDate.before(now) && !lesson.offerEndDate.after(now))){
								<span class="price-current red">¥
			            			<span class="red">@lesson.offerPrice.intValue()</span>
		                        </span>
		                        <span class="price-orignal grey">¥
			            			<span class="grey line-through">@lesson.price.intValue()</span>
		                        </span>
		                        <span class="promt-info">
					            	开课预售至! 还有30天     
					            </span>
							}else{
								<span class="price-orignal orange">¥
			            			<span class="orange">@lesson.price.intValue()</span>
		                        </span>
							}
	                    </p>
	                    <div class="course-price-discount">
	                        <div class="course-coupon js-coupon-wrap hide" style="display: none;"></div>
	                    </div>
	                </div>
	                <div class="oper-bar">
	                    <a class="btn-join btn-blue" href="@routes.PaymentController.paymentReview(lesson.id)">立即报名</a>
	                    <span class="btn-advice-wrap">
			         		<span class="btn-advice-wording btn-outline">咨询</span>
		                    <span class="btn-advice-qq btn-outline btn-advice hide">在线</span>
		                    <span class="js-btn-advice-tel btn-advice-tel btn-outline btn-advice hide" data-tel="01052877654">电话</span>
	                    </span>
	                </div>
	                <div style="clear:both;"></div>
	            </div>
	        </div>
	    </div>
	    <div class="lesson-detail-wrap">
	        <div class="lesson-detail">
	            <div class="content tabs">
	                <div class="tabs-tt-bar">
	                    <h2 class="tabs-tt active">SUMMARY</h2>
	                    <h2 class="tabs-tt">CATALOG</h2>
	                    <h2 class="tabs-tt">COMMENTS</h2>
	                </div>
	
	                <div class="tabs-content" id="basic_tab">
	                    <h3 class="guide-tt js-teacher-location" data-teacherlocation="1">老师介绍</h3>
	                    <div class="teacher-item">
	                    	@if(account.user.avatars != null && account.user.avatars.size() > 0){
								<a href="@routes.ProfileController.teacherDetail(lesson.teacher.accountId)" target="_blank" style="background-image:url('@routes.ProfileController.showAvatarThumbnail(account.user.avatars.get(0).thumbnailUUID)');" class="link-img"></a>
							}else{
								<a href="@routes.ProfileController.teacherDetail(lesson.teacher.accountId)" target="_blank" style="background-image:url('@routes.ProfileController.showAvatarThumbnail()');" class="link-img"></a>
							}
	                        <div class="teacher-summary">
	                            <h4 class="text-tt"><a class="tt-link js-teacher-name" href="/teacher/2697535167" title="于磊Simon" target="_blank">@lesson.teacher.realName</a></h4>
	                            <div class="text-intro js-teacher-intro">@Html(lesson.teacher.brief)</div>
	                        </div>
	                    </div>
	                    <table class="tb-course">
	                        <tbody>
	                            <tr>
	                                <th>简　　介</th>
	                                <td>
	                                	@Html(lesson.description)
	                                </td>
	                            </tr>
	                        </tbody>
	                    </table>
	                    @if(lesson.lessonImages.size() > 0){
	                    	<div class="lesson-gallery">
	                    		@for(lessonImage <- lesson.lessonImages){
	                    			<div class="img-item">
	                    				@if(lessonImage.title != null){
	                    					<p class="img-tt">@lessonImage.title</p>
	                    				}
			                            <img src="/lesson/show/image?uuid=@lessonImage.uuid&isLarge=true">
			                        </div>
	                    		}
		                    </div>
	                    }
	                </div>
	
	                <div class="tabs-content hide" id="dir_tab">
	                    <div class="course-class-task" id="js_class_task">
	                        <div class="task-schedule js-schedule task-schedule--no-begin">
	                            <span class="schedule-start">@lesson.startDatetime.format("MMM dd, yyyy")</span>
	                            <div class="schedule-progress-wrap">
	                                <div class="schedule-progress"><span class="percent" style="width: 0%;"></span></div>
	                            </div>
	                            <span class="schedule-end">@lesson.endDatetime.format("MMM dd, yyyy")</span>
	                        </div>
	                    </div>
	                    <div class="task-chapter">
	                        <div class="task-part-list">
	                       		@for(index <- 0 until lesson.lessonSessions.size){
	                       			<div class="task-part-item">
		                                <div class="task-part-hd">
		                                    <span class="tt-prefix">第@(index + 1)节</span>
		                                    <h3 class="part-tt">
		                                    <i class="fa fa-play-circle-o item-icon"></i>
		                                    	<span class="title">
				                                    @diff(new Date(), lesson.lessonSessions(index).startDatetime) match {
														case a if a <= -lesson.lessonSessions(index).duration => {【回放】@lesson.lessonSessions(index).title}
														case a if (a > -lesson.lessonSessions(index).duration && a <= 0) || (a > 0 && a <= 30) => {【直播中】@lesson.lessonSessions(index).title}
														case a if a > 30 => {【直播】@lesson.lessonSessions(index).title}
													}
												</span>
												<span class="time">@lesson.lessonSessions(index).startDatetime.format("HH:mm dd-MMM-yyyy")</span>
											</h3>
		                                </div>
		                                <!-- <div class="task-task-list">
		                                    <a class="task-task-item task-item-nojump" href="javascript:void(0);">
		                                        <i class="fa fa-play-circle-o item-icon"></i>
		                                        <span class="task-tt-text" title="【回放】part2技巧/结构/思路移植法">【回放】part2技巧/结构/思路移植法</span><span class="tt-suffix">(12月20日 20:30-22:30)</span>
		                                    </a>
		                                </div> -->
		                            </div>
	                       		} 
	                        </div>
	                    </div>
	                </div>
	                
	                <div class="tabs-content hide" id="comment_tab">
	                    <div class="mod-comments-list" id="js-comments-list">
	                        <div class="section-comment-list grid-data">
	                            <div class="comment-filter grid-row-1">
	                                <div class="comment-statistics"> <span class="statistics-num">  <span style="color: red;">-</span> </span> 好评度 </div>
	                                <div class="f-rc-list filter-comment-rank js-f-rc-list">
	                                    <label class="f-radio checked" data-id="0"><i class="icon-radio"></i><span class="f-rc-text">全部评价(4)</span></label>
	                                    <label class="f-radio " data-id="1"><i class="icon-radio"></i><span class="f-rc-text">好评(4-5)</span></label>
	                                    <label class="f-radio " data-id="2"><i class="icon-radio"></i><span class="f-rc-text">中评(3)</span></label>
	                                    <label class="f-radio " data-id="3"><i class="icon-radio"></i><span class="f-rc-text">差评(1-2)</span></label>
	                                </div>
	                            </div>
	                            <div class="comment-list grid-row-2">
	                            </div>
	                        </div>
	                    </div>
	                </div>
	            </div>
	        </div>
	        
	        <aside class="aside-right">
				<h2 class="serv-tt">知名大学</h2>
				<p class="serv-brief">成绩优异的学生我们将会提供一次免费国际知名大学的入学考试。合作大学列表如下：</p>
				<ul class="univercity-list">
					<li class="univercity-item">
						<a class="link-img" style="background-image:url('https://yalenusblog.files.wordpress.com/2012/07/nus_shield1.gif');"></a>
						<p>新加坡国立大学</p>
					</li>
					<li class="univercity-item">
						<a class="link-img" style="background-image:url('http://www.sg-akc.com/images/CSR/CSR160503_img.jpg');"></a>
						<p>新加坡南阳理工大学</p>
					</li>
					<li class="univercity-item">
						<a class="link-img" style="background-image:url('https://encrypted-tbn1.gstatic.com/images?q=tbn:ANd9GcRRkq5lJo5DBQCFxdMDXnua6Cuxq6Gz9bKNSm-9aDdXBHABHOT7');"></a>
						<p>英国剑桥大学</p>
					</li>
				</ul>
				<p>欢迎来电咨询：<span class="tel">0041-82938394</span></p>
	        </aside>
	        
	        <div style="clear:both;"></div>
	    </div>
	</div>
	@entry(account)
    @modalcreatelesson()
}
