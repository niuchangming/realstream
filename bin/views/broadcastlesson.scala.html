@(broadcastSession: BroadcastSession)

@scripts = {
	<script src="https://static.opentok.com/v2/js/opentok.min.js"></script>
    <script type="text/javascript">
    	var session = OT.initSession('45706182', '@broadcastSession.sessionId');
    	
    	session.connect('@broadcastSession.token', function(error) {
			if (!error) {
      		    publish();
			} else {
				alert('There was an error connecting to the session(' +  error.code + "): " + error.message);
			}
  		});
    	
    	session.on('streamCreated', function(event) {
			session.subscribe(event.stream, 'publisher', {
				insertMode: 'append',
				width: '100%',
				height: '100%'
			});
			alert('Receive Stream...');
  		});
    	
    	function publish(){
    		var publisher = OT.initPublisher('video_container', null, function(error) {
    		  if (error) {
    			  alert('Publisher initialized failed: ' + error);
    		  } else {
    			  alert('Session publish Publisher...');
    			  session.publish(publisher, function(error) {
    					if (error) {
    						alert(error);
    					} else {
    						alert('Publishing a stream.');
    					}
					});
    		  }
    		});
    	}
    </script>
}

@main(scripts) {
	
	<div id="video_container"></div>
	
}